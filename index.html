<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estudio de Fórceps</title>

<style>

body {
    font-family: Arial;
    background: #121212;
    color: white;
    text-align: center;
    padding: 20px;
}

#imageContainer {
    margin: 20px;
}

img {
    max-width: 500px;
    max-height: 400px;
    border-radius: 10px;
    border: 3px solid white;
}

select {
    padding: 12px;
    font-size: 18px;
    width: 400px;
    margin-top: 15px;
    border-radius: 5px;
}

button {
    padding: 10px 20px;
    font-size: 18px;
    margin: 10px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}

button:hover {
    background: #444;
    color: white;
}

#result {
    font-size: 22px;
    margin-top: 15px;
    height: 30px;
}

#score {
    margin-top: 10px;
    font-size: 18px;
}

#progress {
    margin-top: 5px;
    color: #aaa;
}

.correct {
    color: lightgreen;
}

.incorrect {
    color: red;
}

</style>

</head>
<body>

<h1>Entrenamiento de Fórceps</h1>

<div id="progress"></div>

<div id="imageContainer">
    <img id="forcepsImage">
</div>

<div>
    <select id="answerSelect">
        <option value="">-- Selecciona una opción --</option>
    </select>
</div>

<div>
    <button onclick="checkAnswer()">Comprobar</button>
    <button onclick="nextForceps()">Siguiente</button>
</div>

<div id="result"></div>
<div id="score"></div>

<script>

let forcepsList = [];
let currentIndex = -1;
let lastIndex = -1;

let correct = 0;
let total = 0;


// CARGAR JSON

fetch("forceps.json")
.then(response => response.json())
.then(data => {

    forcepsList = data;

    populateDropdown();

    nextForceps();

});


// LLENAR DROPDOWN

function populateDropdown() {

    const select = document.getElementById("answerSelect");

    select.innerHTML =
        '<option value="">-- Selecciona una opción --</option>';

    forcepsList.forEach(item => {

        const option = document.createElement("option");

        option.value = item.name;

        option.textContent = item.name;

        select.appendChild(option);

    });

}


// GENERAR ÍNDICE ALEATORIO SIN REPETIR

function getRandomIndex() {

    if(forcepsList.length <= 1)
        return 0;

    let newIndex;

    do {

        newIndex =
            Math.floor(Math.random() * forcepsList.length);

    } while(newIndex === lastIndex);

    return newIndex;

}


// CARGAR SIGUIENTE

function nextForceps() {

    lastIndex = currentIndex;

    currentIndex = getRandomIndex();

    const item = forcepsList[currentIndex];

    document.getElementById("forcepsImage").src =
        "images/" + item.image;

    document.getElementById("answerSelect").value = "";

    document.getElementById("result").textContent = "";

    document.getElementById("progress").textContent =
        "Pregunta " + (total + 1);

}


// COMPROBAR

function checkAnswer() {

    const selected =
        document.getElementById("answerSelect").value;

    if(selected === "") return;

    const correctName =
        forcepsList[currentIndex].name;

    total++;

    if(selected === correctName) {

        correct++;

        showResult(true, correctName);

    } else {

        showResult(false, correctName);

    }

    updateScore();

}


// RESULTADO

function showResult(isCorrect, correctName) {

    const result = document.getElementById("result");

    if(isCorrect) {

        result.textContent = "✅ Correcto";

        result.className = "correct";

    } else {

        result.textContent =
            "❌ Incorrecto — Era: " + correctName;

        result.className = "incorrect";

    }

}


// SCORE

function updateScore() {

    const percent =
        total > 0 ?
        Math.round(correct/total*100) : 0;

    document.getElementById("score").textContent =
        "Aciertos: " +
        correct +
        " / " +
        total +
        " (" + percent + "%)";

}

</script>

</body>
</html>