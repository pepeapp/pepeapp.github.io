<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Estudio de Fórceps</title>

<style>

body {
    font-family: Arial;
    background: #121212;
    color: white;
    text-align: center;
    padding: 20px;
}

h1 {
    margin-bottom: 5px;
}

#imageContainer {
    margin: 20px;
}

img {
    max-width: 500px;
    max-height: 400px;
    border-radius: 10px;
    border: 3px solid white;
}

input {
    padding: 12px;
    font-size: 18px;
    width: 350px;
    margin-top: 15px;
    border-radius: 5px;
    border: none;
}

button {
    padding: 10px 20px;
    font-size: 18px;
    margin: 10px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
}

button:hover {
    background: #444;
    color: white;
}

#result {
    font-size: 22px;
    margin-top: 15px;
    height: 30px;
}

#score {
    margin-top: 10px;
    font-size: 18px;
}

#progress {
    margin-top: 5px;
    color: #aaa;
}

</style>

</head>
<body>

<h1>Estudio de Fórceps</h1>

<div id="progress"></div>

<div id="imageContainer">
    <img id="forcepsImage">
</div>

<div>
    <input id="answerInput" placeholder="Escribe el nombre">
</div>

<div>
    <button onclick="checkAnswer()">Comprobar</button>
    <button onclick="nextForceps()">Siguiente</button>
</div>

<div id="result"></div>
<div id="score"></div>

<script>

let forcepsList = [];
let currentIndex = 0;
let correct = 0;
let total = 0;


// CARGAR JSON

fetch("forceps.json")
.then(response => response.json())
.then(data => {

    forcepsList = data;

    shuffle(forcepsList);

    loadForceps();

});


// MEZCLAR

function shuffle(array) {

    for (let i = array.length - 1; i > 0; i--) {

        const j = Math.floor(Math.random() * (i + 1));

        [array[i], array[j]] = [array[j], array[i]];

    }

}


// CARGAR FORCEPS

function loadForceps() {

    const item = forcepsList[currentIndex];

    document.getElementById("forcepsImage").src =
        "images/" + item.image;

    document.getElementById("answerInput").value = "";

    document.getElementById("result").textContent = "";

    document.getElementById("progress").textContent =
        "Imagen " + (currentIndex + 1) + " de " + forcepsList.length;

}


// NORMALIZAR TEXTO

function normalize(text) {

    return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")
        .trim();

}


// COMPROBAR

function checkAnswer() {

    const userAnswer =
        normalize(document.getElementById("answerInput").value);

    const item = forcepsList[currentIndex];

    const correctName = normalize(item.name);

    const aliases = item.aliases.map(a => normalize(a));

    total++;

    if (userAnswer === correctName || aliases.includes(userAnswer)) {

        correct++;

        showResult(true, item.name);

    } else {

        showResult(false, item.name);

    }

    updateScore();

}


// RESULTADO

function showResult(isCorrect, correctName) {

    const result = document.getElementById("result");

    if(isCorrect) {

        result.textContent = "✅ Correcto";

        result.style.color = "lightgreen";

    } else {

        result.textContent = "❌ Incorrecto — Era: " + correctName;

        result.style.color = "red";

    }

}


// SIGUIENTE

function nextForceps() {

    currentIndex++;

    if(currentIndex >= forcepsList.length) {

        shuffle(forcepsList);

        currentIndex = 0;

    }

    loadForceps();

}


// SCORE

function updateScore() {

    document.getElementById("score").textContent =
        "Aciertos: " + correct + " / " + total +
        " (" + Math.round(correct/total*100) + "%)";

}


// ENTER

document
.getElementById("answerInput")
.addEventListener("keypress", function(e){

    if(e.key === "Enter")
        checkAnswer();

});

</script>

</body>
</html>